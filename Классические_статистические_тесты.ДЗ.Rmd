---
title: "Классические_статистические_тесты.ДЗ"
author: "Oleg Arnaut"
date: "2024-11-25"
output: html_document
---


```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(dplyr)

```

# Инструкции

Ниже приведены семь клинических (исследовательских) гипотез. В качестве задания протестируйте их, используя соответствующие статистические критерии. Решение должно содержать все элементы алгоритма проверки статистических гипотез:

• Сформулируете нулевую и альтернативную гипотезы.
• Укажите уровень значимости α.
• Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста. 
• Укажите критическое значение статистики (используйте распределения из материалов лекции).
• Определите наблюдаемое значение статистики.
• Оцените статистическую значимость (p-value и/или доверительный интервал).
• Оцените практическую значимость.


* Решение необходимо загружать в формате Rmd (воспроизводимый код).
** Данные для анализа необходимо генерировать самостоятельно в соответствии с каждой представленной гипотезой. По возможности используйте пакет dplyr
*** Предусмотрен мягкий дедлайн (17 ноября). В этом случае вы получите комментарии с возможностью повысить оценку. Сдача работы после жёсткого дедлайна (24 ноября) предусматривает снижение оценки (10 баллов).


# Гипотеза 1. Существует ассоциация между уровнем физической активности (бинарная переменная, физическая активность может быть 'высокой' и 'низкой') и частотой возникновения сердечно-сосудистых заболеваний у пациентов старше 50 лет. Попробуйте вариант с большими выборками (sample_size <- 100). Как изменится стратегия при малых выборках (sample_size <- 30) ? 

## Генерация данных

```{r}

# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки 
sample_size_100 <- 100

# Генерация данных по физической активности (бинарная переменная) в фиксированном соотношении 1:1
activity_100 <- sample(c("high", "low"), sample_size_100, replace = TRUE)

# Генерация данных по наличию сердечно-сосудистых заболеваний (бинарная переменная)
# У активных людей меньше вероятность заболеть (0.5 vs 0.6)

cardio_100 <- ifelse(activity_100 == "high", rbinom(sample_size_100, 1, 0.5), rbinom(sample_size_100, 1, 0.6))
```

Данный чанк сохраняет значения для малых выборок

```{r}

# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки
sample_size_30 <- 30

# Генерация данных по физической активности (бинарная переменная) в фиксированном соотношении 1:1
activity_30 <- sample(c("high", "low"), sample_size_30, replace = TRUE)

# Генерация данных по наличию сердечно-сосудистых заболеваний (бинарная переменная)
# У активных людей меньше вероятность заболеть (0.5 vs 0.6)

cardio_30 <- ifelse(activity_30 == "high", rbinom(sample_size_30, 1, 0.5), rbinom(sample_size_30, 1, 0.6))
    
```


## Решение

```{r}
# Таблица частот для больших выборок
table(activity_100, cardio_100)

# Проведение теста хи-квадрат на больших выборок
chisq_test_100 <- chisq.test(table(activity_100, cardio_100))
print(chisq_test_100)

# Таблица частот для малых выборок
table(activity_30, cardio_30)

# Проведение теста хи-квадрат на малых выборок
chisq_test_30 <- chisq.test(table(activity_30, cardio_30))
print(chisq_test_30)

```

Интерпретация: В больших выборках тест хи-квадрат выявляет статистически значимую связь между уровнем физической активности и частотой сердечно-сосудистых заболеваний, о чем свидетельствует p-значение менее 0,05. Это говорит о том, что наблюдаемая связь вряд ли объясняется случайностью. Однако в меньших выборках p-значение превышает 0,05, что означает, что размер выборки недостаточен для достоверного обнаружения этой связи. Это расхождение можно объяснить снижением статистической мощности в небольших выборках, что может не позволить выявить истинные эффекты, особенно если размер эффекта незначителен. Кроме того, более высокая вариабельность в небольших наборах данных может затушевать истинную ассоциацию, что еще больше усугубляет неспособность обнаружить значимость. Таким образом, полученные данные подчеркивают важность адекватного размера выборки для обеспечения надежности статистических тестов и выявления значимых ассоциаций.


# Гипотеза 2. Применение нового метода лечения для пациентов с артериальной гипертензией приведет к уменьшению среднего артериального давления по сравнению с пациентами, получающими стандартное лечение.


## Генерация данных 

```{r}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки (в каждой группе)
sample_size <- 80


# В популяции c экспериментальным методом лечения средний уровень систолического артериального давления меньше (130 vs 135 mm) 
# Генерация данных для группы с новым методом лечения 
group1 <- rnorm(sample_size, mean = 130, sd = 10)  # экспериментальная группа

# Генерация данных для группы со стандартным лечением
group2 <- rnorm(sample_size, mean = 135, sd = 10)  # контрольная группа

```

## Решение

```{r}

t_test <- t.test(group1, group2)
print(t_test)

```

Интерпретация: t-тест показал статистически значимую разницу в среднем артериальном давлении между новым и традиционным методами лечения (p < 0,05), что свидетельствует о том, что новый метод более эффективен в снижении артериального давления.

# Гипотеза 3. Внедрение программы реабилитации для пациентов с хронической болью в спине приведет к улучшению их физической активности (предположим что физическую активность можно оценить по шкале 0-100)

## Генерация данных 

```{r}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки 
sample_size <- 30

# В популяции до реабилитации средний уровень физической активности меньше (50 vs 60) 
# Генерация данных до реабилитации
before <- rnorm(sample_size, mean = 50, sd = 10)

# Генерация данных после реабилитации
after <- rnorm(sample_size, mean = 60, sd = 10)  

```

## Решение

```{r}

t_test_paired <- t.test(before, after, paired = TRUE)
print(t_test_paired)

```

Интерпретация: Парный t-тест показал статистически значимое улучшение после реабилитации с p-значением менее 0,05. 

# Гипотеза 4. Применение нового метода лечения для пациентов с инфарктом миокарда увеличит долю вернувшихся к нормальной физической активности 

## Генерация данных 

```{r}

# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки
sample_size <- 200


# В популяции экспериментального лечения вероятность нормальной физической активности больше (0.7 vs 0.65)
# Генерация данных по статусу лечение (бинарная переменная, новый метод или стандарт) в фиксированном соотношении 1:1
treatment <- sample(c("new", "standard"), sample_size, replace = TRUE)

# Генерация данных по физической активности после лечения (бинарная переменная)
activity <- ifelse(treatment == "new", rbinom(sample_size, 1, 0.7), rbinom(sample_size, 1, 0.65))

    
```

## Решение

```{r}
# Переведём в для быстрого создания частотных таблиц
chisq_test_myocard <- chisq.test(table(treatment, activity))
print(chisq_test_myocard)

```

Интерпретация: Тест хи-квадрат показал наличие значимой связи между методом лечения и уровнем физической активности при p-значении ниже 0,05.

# Гипотеза 5. Применение медитации в течение 8 недель повлияет на наличие стресса (есть/нет) у лиц с высоким уровнем тревожности.

## Генерация данных 

```{r}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки
sample_size <- 50

# Генерация данных до медитации (бинарная переменная) в фиксированном соотношении 1:1
before <- rbinom(sample_size, 1, 0.4)

# Генерация данных после медитации (бинарная переменная). После медитации вероятность наличия стресса меньше (0.2 vs 0.4)
after <- rbinom(sample_size, 1, 0.2)

```

## Решение

```{r}

chisq_test_stress <- chisq.test(table(before, after))
print(chisq_test_stress)

```

Интерпретация: Тест хи-квадрат показал статистически значимое снижение уровня стресса после медитации при значении p-value ниже 0,05.

# Гипотеза 6. Применение альтернативного метода лечения для пациентов с биполярным расстройством приведет к значимому изменению уровня симптомов депрессии по отношению к группе, прошедшей стандартное лечение (депрессию можно определить по шкале от 0 до 100, при этом исследователь должен избегать любых предположений (кроме i.i.d.)).

## Генерация данных 

```{r}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки для каждой группы
sample_size <- 20


# В популяции c экспериментальным методом лечения среднее депрессии меньше (55 vs 68) 
# Генерация данных для экспериментальной группы 
group1 <- rnorm(sample_size, mean = 55, sd = 10)  # экспериментальная группа

# Генерация данных для группы со стандартным лечением
group2 <- rnorm(sample_size, mean = 68, sd = 10)  # контрольная группа

```

## Решение

```{r}

t_test_depression <- t.test(group1, group2)
print(t_test_depression)

```

Интерпретация: t-тест показал, что альтернативный метод лечения приводит к статистически значимому снижению уровня депрессии по сравнению со стандартным методом, при p-значении менее 0,05.

# Гипотеза 7. Длительность сна (в часах) ассоциирована с уровенем стресса у студентов (шкала с нормальным распределением)

## Генерация данных  

```{r}

library(mvtnorm) # библиотека mvtnorm для работы с многомерным нормальным распределением

# Воспроизводимость результатов
set.seed(42)

# Размер выборки
sample_size <- 100

# Средние значения для длительности сна (HoursOfSleep) и уровня стресса (StressLevel) в популяции
means <- c(7, 5)  

# Матрица ковариации. В ислледуемой популяции HoursOfSleep и StressLevel ассоциированы отрицательно (r = -0.5)
cov_matrix <- matrix(c(1, -0.5, -0.5, 1), nrow = 2)

df <- rmvnorm(n = sample_size, 
              mean = means, 
              sigma = cov_matrix) %>% 
      as_tibble() %>%
      setNames(c("HoursOfSleep", "StressLevel"))  

```
## Решение (дополните решение визуализацией)

```{r}

corr<- cor.test(df$HoursOfSleep, df$StressLevel)
print(corr)

```

Интерпретация: Корреляционный анализ выявил статистически значимую отрицательную корреляцию между продолжительностью сна и уровнем стресса (r = -0.5222265, p = 2.511e-08), что указывает на то, что более продолжительный сон связан с меньшим стрессом.








